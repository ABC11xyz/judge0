#!/bin/bash
export JUDGE0_DOCKER_REPOSITORY=judge0/api

export JUDGE0_PROJECT_ROOT="$(git rev-parse --show-toplevel)"
export JUDGE0_COMMIT="$(git log -1 --format=%h --abbrev=8)"
export JUDGE0_BRANCH="$(git rev-parse --abbrev-ref HEAD)"

export JUDGE0_EDITION="$JUDGE0_BRANCH"
if [[ "$JUDGE0_BRANCH" == "master" ]]; then
    export JUDGE0_EDITION="standard"
fi

export JUDGE0_EDITION_SLUG="-$JUDGE0_EDITION"
if [[ "$JUDGE0_EDITION" == "standard" ]]; then
    export JUDGE0_EDITION_SLUG=""
fi

export JUDGE0_VERSION_TAG="$(git tag --points-at HEAD)"
export JUDGE0_VERSION="${JUDGE0_VERSION_TAG:1}"

export JUDGE0_PRODUCTION_IMAGES="$JUDGE0_DOCKER_REPOSITORY:$JUDGE0_COMMIT$JUDGE0_EDITION_SLUG"
if [[ "$JUDGE0_VERSION" != "" ]]; then
    export JUDGE0_PRODUCTION_IMAGES="$JUDGE0_PRODUCTION_IMAGES $JUDGE0_DOCKER_REPOSITORY:latest$JUDGE0_EDITION_SLUG"
    export JUDGE0_PRODUCTION_IMAGES="$JUDGE0_PRODUCTION_IMAGES $JUDGE0_DOCKER_REPOSITORY:$JUDGE0_VERSION$JUDGE0_EDITION_SLUG"
fi

export JUDGE0_DEVELOPMENT_IMAGES="$JUDGE0_DOCKER_REPOSITORY:$JUDGE0_COMMIT-dev$JUDGE0_EDITION_SLUG"
if [[ "$JUDGE0_VERSION" != "" ]]; then
    export JUDGE0_DEVELOPMENT_IMAGES="$JUDGE0_DEVELOPMENT_IMAGES $JUDGE0_DOCKER_REPOSITORY:latest-dev$JUDGE0_EDITION_SLUG"
    export JUDGE0_DEVELOPMENT_IMAGES="$JUDGE0_DEVELOPMENT_IMAGES $JUDGE0_DOCKER_REPOSITORY:$JUDGE0_VERSION-dev$JUDGE0_EDITION_SLUG"
fi

# Informational output.
env | grep JUDGE0_ | sort